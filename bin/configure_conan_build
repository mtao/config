#!/bin/bash

function init_cmake() {
    cat $( conan profile path "$1" ) | grep build_type | tr "=" " " | awk '{ print $2 }'
    cmake .. -DCMAKE_TOOLCHAIN_FILE=conan_toolchain.cmake

}

function init_meson() {
    meson setup --native-file conan/conan_meson_native.ini .. .
}

function run() {
    #takes as input a single arg that is the meson profile name. otherwise it uses the default one
    profile=${1}
    if [[ -n "$profile" ]]; then
        conan_profile=$profile
        build_folder=build-$profile
    else
        conan_profile=default
        build_folder=build
    fi

    mkdir -p $build_folder
    conan install . --output-folder=$build_folder/conan --build=missing --profile=$conan_profile

    if [ -f meson.build ] then


    pushd $build_folder


    ninja # build
    popd
}


for profile in $@; do
    run "$profile"
done
